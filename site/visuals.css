/* ============================================
   SANCTUM & SHADOW — VISUALS CSS
   Phase 1: NPC Portraits
   Phase 2: Spell / Combat VFX
   Phase 3: Location Backgrounds
   ============================================ */

/* ─── PHASE 3: LOCATION BACKGROUNDS ────────── */

.center-panel {
  position: relative;
  overflow: hidden;
}

.center-panel::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--loc-bg, linear-gradient(160deg, #0a0604 0%, #1a0e08 40%, #0d0906 100%));
  background-size: cover;
  background-position: center top;
  opacity: 0.18;
  z-index: 0;
  transition: background 1.2s ease, opacity 1.2s ease;
  pointer-events: none;
}

.center-panel.has-bg-image::before {
  opacity: 0.22;
  filter: saturate(0.7) brightness(0.6);
}

.center-panel > * {
  position: relative;
  z-index: 1;
}

/* Transition flash when location changes */
.center-panel.bg-transitioning::after {
  content: '';
  position: absolute;
  inset: 0;
  background: #000;
  z-index: 10;
  animation: locationFadeIn 0.6s ease forwards;
  pointer-events: none;
}

@keyframes locationFadeIn {
  0%   { opacity: 0.5; }
  100% { opacity: 0; }
}

/* ─── PHASE 1: NPC PORTRAITS ────────────────── */

/* Replaces the emoji in the conv panel header */
.npc-portrait-wrap {
  position: relative;
  width: 72px;
  height: 96px;
  flex-shrink: 0;
  border: 1px solid rgba(201,168,76,0.3);
  overflow: hidden;
}

.npc-portrait-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center top;
  display: block;
  filter: saturate(0.85) contrast(1.1);
  transition: filter 0.3s;
}

.npc-portrait-img:hover {
  filter: saturate(1) contrast(1.05);
}

.npc-portrait-vignette {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to bottom,
    transparent 50%,
    rgba(4,2,1,0.7) 100%
  );
  pointer-events: none;
}

.npc-portrait-emoji {
  width: 72px;
  height: 96px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.8rem;
  background: rgba(201,168,76,0.06);
  border: 1px solid rgba(201,168,76,0.2);
  flex-shrink: 0;
}

/* In-game portrait that appears in scene panel */
.scene-portrait {
  float: right;
  width: 80px;
  height: 110px;
  margin: 0 0 8px 12px;
  border: 1px solid rgba(201,168,76,0.25);
  overflow: hidden;
  shape-outside: border-box;
}

.scene-portrait img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center top;
  filter: saturate(0.8);
}

/* ─── PHASE 2: VFX OVERLAYS ─────────────────── */

.vfx-overlay {
  position: absolute;
  inset: 0;
  z-index: 1800;
  pointer-events: none;
  border-radius: inherit;
  animation-duration: var(--vfx-duration, 600ms);
  animation-fill-mode: forwards;
  animation-timing-function: ease-out;
}

/* ── Fire / Hell ── */
.vfx-fire {
  background: radial-gradient(ellipse at 50% 80%,
    rgba(255,100,0,0.6) 0%,
    rgba(200,30,0,0.4) 40%,
    transparent 70%
  );
  animation-name: vfxFireBurst;
}

@keyframes vfxFireBurst {
  0%   { opacity: 0; transform: scaleY(0.3) scaleX(0.6); }
  20%  { opacity: 1; transform: scaleY(1.2) scaleX(1); }
  60%  { opacity: 0.8; transform: scaleY(1) scaleX(1); }
  100% { opacity: 0; transform: scaleY(1.5) scaleX(0.8); }
}

/* ── Holy / Divine ── */
.vfx-holy {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(255,253,200,0.7) 0%,
    rgba(255,220,80,0.4) 40%,
    transparent 70%
  );
  animation-name: vfxHolyPulse;
}

.vfx-holy-big {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(255,255,200,0.9) 0%,
    rgba(255,220,80,0.6) 30%,
    rgba(255,180,20,0.3) 60%,
    transparent 80%
  );
  animation-name: vfxHolyBig;
}

@keyframes vfxHolyPulse {
  0%   { opacity: 0; transform: scale(0.5); }
  30%  { opacity: 1; transform: scale(1.1); }
  70%  { opacity: 0.7; }
  100% { opacity: 0; transform: scale(1.3); }
}

@keyframes vfxHolyBig {
  0%   { opacity: 0; transform: scale(0.3) rotate(-5deg); }
  20%  { opacity: 1; transform: scale(1.2) rotate(2deg); }
  60%  { opacity: 0.9; transform: scale(1) rotate(0deg); }
  100% { opacity: 0; transform: scale(1.5) rotate(3deg); }
}

/* ── Heal ── */
.vfx-heal {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(100,220,120,0.6) 0%,
    rgba(60,180,80,0.3) 50%,
    transparent 70%
  );
  animation-name: vfxHealRise;
}

.vfx-heal-big {
  background: radial-gradient(ellipse at 50% 100%,
    rgba(120,240,140,0.7) 0%,
    rgba(80,200,100,0.4) 40%,
    transparent 70%
  );
  animation-name: vfxHealRise;
}

@keyframes vfxHealRise {
  0%   { opacity: 0; transform: translateY(10px) scale(0.8); }
  30%  { opacity: 1; transform: translateY(-5px) scale(1); }
  70%  { opacity: 0.6; }
  100% { opacity: 0; transform: translateY(-20px) scale(1.1); }
}

/* ── Arcane ── */
.vfx-arcane {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(150,100,230,0.65) 0%,
    rgba(100,60,200,0.4) 40%,
    transparent 70%
  );
  animation-name: vfxArcaneSpin;
}

.vfx-arcane-big {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(200,150,255,0.8) 0%,
    rgba(150,80,255,0.5) 30%,
    rgba(100,40,200,0.3) 60%,
    transparent 80%
  );
  animation-name: vfxArcaneSpin;
}

@keyframes vfxArcaneSpin {
  0%   { opacity: 0; transform: scale(0.4) rotate(-20deg); }
  25%  { opacity: 1; transform: scale(1.1) rotate(5deg); }
  60%  { opacity: 0.8; transform: scale(1) rotate(0deg); }
  100% { opacity: 0; transform: scale(1.3) rotate(10deg); }
}

/* ── Lightning ── */
.vfx-lightning {
  background: radial-gradient(ellipse at 50% 30%,
    rgba(200,240,255,0.9) 0%,
    rgba(100,200,255,0.5) 30%,
    transparent 60%
  );
  animation-name: vfxLightningStrike;
}

@keyframes vfxLightningStrike {
  0%   { opacity: 0; }
  5%   { opacity: 1; }
  15%  { opacity: 0.2; }
  25%  { opacity: 0.9; }
  40%  { opacity: 0.3; }
  55%  { opacity: 0.8; }
  100% { opacity: 0; }
}

/* ── Shadow ── */
.vfx-shadow {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(40,20,80,0.8) 0%,
    rgba(20,10,50,0.5) 50%,
    transparent 70%
  );
  animation-name: vfxShadowCollapse;
}

.vfx-shadow-big {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(60,30,120,0.9) 0%,
    rgba(40,10,80,0.6) 40%,
    rgba(10,5,30,0.3) 70%,
    transparent 90%
  );
  animation-name: vfxShadowCollapse;
}

@keyframes vfxShadowCollapse {
  0%   { opacity: 0; transform: scale(1.5); }
  30%  { opacity: 1; transform: scale(0.9); }
  60%  { opacity: 0.7; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.7); }
}

/* ── Hit / Miss / Crit ── */
.vfx-hit {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(192,57,43,0.45) 0%,
    transparent 60%
  );
  animation-name: vfxHitFlash;
}

.vfx-miss {
  background: rgba(100,100,100,0.15);
  animation-name: vfxHitFlash;
}

.vfx-crit {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(255,0,0,0.55) 0%,
    rgba(200,0,0,0.3) 40%,
    transparent 70%
  );
  animation-name: vfxCritBurst;
}

@keyframes vfxHitFlash {
  0%   { opacity: 1; }
  100% { opacity: 0; }
}

@keyframes vfxCritBurst {
  0%   { opacity: 0; transform: scale(0.3); }
  20%  { opacity: 1; transform: scale(1.2); }
  50%  { opacity: 0.8; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.4); }
}

/* ── Buff ── */
.vfx-buff {
  background: radial-gradient(ellipse at 50% 100%,
    rgba(255,140,50,0.5) 0%,
    rgba(255,100,20,0.3) 40%,
    transparent 70%
  );
  animation-name: vfxBuffRise;
}

@keyframes vfxBuffRise {
  0%   { opacity: 0; transform: scaleY(0.5); }
  30%  { opacity: 1; transform: scaleY(1.1); }
  70%  { opacity: 0.6; }
  100% { opacity: 0; transform: scaleY(1.3) translateY(-10%); }
}

/* ── Slash ── */
.vfx-slash {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(192,57,43,0.5) 0%,
    transparent 60%
  );
  animation-name: vfxSlash;
}

@keyframes vfxSlash {
  0%   { opacity: 0; transform: scaleX(0.2) rotate(-10deg); }
  20%  { opacity: 1; transform: scaleX(1.1) rotate(2deg); }
  60%  { opacity: 0.5; }
  100% { opacity: 0; transform: scaleX(1.3) rotate(5deg); }
}

/* ── Smoke ── */
.vfx-smoke {
  background: radial-gradient(ellipse at 50% 50%,
    rgba(130,130,130,0.5) 0%,
    rgba(80,80,80,0.3) 50%,
    transparent 80%
  );
  animation-name: vfxSmokeExpand;
}

@keyframes vfxSmokeExpand {
  0%   { opacity: 0; transform: scale(0.3); filter: blur(0px); }
  30%  { opacity: 0.9; transform: scale(1); filter: blur(4px); }
  70%  { opacity: 0.5; transform: scale(1.3); filter: blur(8px); }
  100% { opacity: 0; transform: scale(1.8); filter: blur(12px); }
}

/* ── Nature ── */
.vfx-nature {
  background: radial-gradient(ellipse at 50% 80%,
    rgba(50,180,80,0.5) 0%,
    rgba(30,120,50,0.3) 40%,
    transparent 70%
  );
  animation-name: vfxNatureGrow;
}

@keyframes vfxNatureGrow {
  0%   { opacity: 0; transform: scaleY(0.2) scaleX(0.5); }
  40%  { opacity: 1; transform: scaleY(1.1) scaleX(1); }
  70%  { opacity: 0.7; }
  100% { opacity: 0; }
}

/* ─── LOTTIE CONTAINER ────────────────────── */
.vfx-lottie-container {
  position: absolute;
  inset: 0;
  z-index: 2000;
  pointer-events: none;
}

.vfx-lottie-container svg {
  max-width: 100%;
  max-height: 100%;
}

/* ─── CHARACTER CREATION PORTRAIT ──────────── */
.portrait-gen-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 32px;
  color: var(--gold, #c9a84c);
}

.portrait-spinner {
  width: 48px;
  height: 48px;
  border: 3px solid rgba(201,168,76,0.2);
  border-top-color: #c9a84c;
  border-radius: 50%;
  animation: portraitSpin 1s linear infinite;
}

@keyframes portraitSpin {
  to { transform: rotate(360deg); }
}

.portrait-gen-text {
  font-family: 'Cinzel', serif;
  font-size: 0.9rem;
  letter-spacing: 0.1em;
  opacity: 0.8;
  animation: portraitPulse 2s ease-in-out infinite;
}

@keyframes portraitPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.portrait-preview-img {
  display: block;
  width: 200px;
  height: 267px;
  object-fit: cover;
  object-position: center top;
  border: 2px solid rgba(201,168,76,0.4);
  margin: 0 auto 16px;
  filter: saturate(0.9) contrast(1.05);
}

.portrait-preview-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 8px;
}
